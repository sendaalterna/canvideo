// brick
// options.cols - number of cols
// options.rows - number of rows
// options.perspective - 3d perspective size

// easing functions
jQuery.extend(jQuery.easing,{easeInBack:function(b,a,f,q,m,c){void 0==c&&(c=1.70158);return q*(a/=m)*a*((c+1)*a-c)+f},easeOutBack:function(b,a,f,q,m,c){void 0==c&&(c=1.70158);return q*((a=a/m-1)*a*((c+1)*a+c)+1)+f},easeInBackQ:function(b,a,f,q,m,c){b=(a/=m)*a;return f+q*b*(4*a*b-8*b+8*a-3)},easeOutBackQ:function(b,a,f,q,m,c){b=(a/=m)*a;return f+q*(4*b*a*b-12*b*b+16*b*a-13*b+6*a)},easeInBackQ2:function(b,a,f,q,m,c){b=(a/=m)*a;return f+q*b*(1.5*a*b-2.5*b+5*a-3)},easeOutBackQ2:function(b,a,f,q,m,c){b=
(a/=m)*a;return f+q*(1.5*b*a*b-5*b*b+10*b*a-12*b+6.5*a)}});
function ws_brick(b,a,f){function q(p){for(var f={},n=a.get(p),w=b.width/v,u=b.height/z,h=0;h<v*z;h++){p=h%v;var x=h;a:{var g=n,d={x:p*w,y:Math.floor(h/v)*u,w:w,h:u},d=d||{};p=d.exclude||[];var c=void 0,l=document.createElement("canvas"),k=l.getContext("2d");l.width=g.naturalWidth;l.height=g.naturalHeight;k.drawImage(g,0,0,g.naturalWidth,g.naturalHeight);try{c=k.getImageData(d.x?d.x:0,d.y?d.y:0,d.w?d.w:g.width,d.h?d.h:g.height).data}catch(e){console.log("error:unable to access image data: "+e);p=
"#ccc";break a}for(var g=(d.w?d.w:g.width*d.h?d.h:g.height)||c.length,d={},l="",k=[],r="",J=0,q=0;q<g;){k[0]=c[q];k[1]=c[q+1];k[2]=c[q+2];l=k.join(",");d[l]=l in d?d[l]+1:1;if(-1===p.indexOf(["rgb(",l,")"].join(""))){var m=d[l];m>J&&(r=l,J=m)}q+=4}p=["rgb(",r,")"].join("")}f[x]=p}return f}function m(b,a){var f=0,c;for(c in b)"function"!==typeof b[c]&&function(b,h){wowAnimate(function(a){var g,d,f,l="",k={};.5>=a?(g=n.easing.easeInBack(1,2*a,0,1,1,1).toFixed(3),d=n.easing.easeInBackQ(1,2*a,0,1,1,1).toFixed(3),
f=n.easing.easeInBackQ2(1,2*a,0,1,1,1).toFixed(3),h[b].back.css("backfaceVisibility","hidden")):(g=n.easing.easeOutBack(1,2*(a-.5),0,1,1,1).toFixed(3),d=n.easing.easeOutBackQ(1,2*(a-.5),0,1,1,1).toFixed(3),f=n.easing.easeOutBackQ2(1,2*(a-.5),0,1,1,1).toFixed(3),h[b].back.css("backfaceVisibility","visible"));for(var e in h[b].animate[.5>=a?"half":"end"]){var c=h[b].animate[.5>=a?"begin":"half"][e]||0,p=h[b].animate[.5>=a?"half":"end"][e]||0;"object"!==typeof p&&(p="scale"===e||"rotateX"===e||"rotateY"===
e?c+(p-c)*d:"left"===e||"top"===e?c+(p-c)*f:c+(p-c)*g);"rotateX"===e||"rotateY"===e||"rotateZ"===e?l+=e+"("+p+"deg) ":"scale"===e?l+=e+"("+p+") ":"translate3d"===e?l+=e+"("+(c[0]+(p[0]-c[0])*g).toFixed(3)+"px,"+(c[1]+(p[1]-c[1])*g).toFixed(3)+"px,"+(c[2]+(p[2]-c[2])*g).toFixed(3)+"px) ":k[e]=p}h[b].wrapper.css({transform:"translate3d("+(k.left?k.left:0).toFixed(3)+"px,"+(k.top?k.top:0).toFixed(3)+"px,0)"});delete k.left;delete k.top;l&&(k.transform=l);h[b].part.css(k)},0,1,h[b].animate.duration,h[b].animate.delay,
function(){f++;f==h.length&&a&&a()})}(c,b)}function c(a,c,n,q){var u=f.width(),h=f.height(),x=u/v,g=h/z,d=1E3<.4*b.duration?1E3:.4*b.duration,t=.6*b.duration,l=[0,0];c=F[c];for(var k in a)"function"!==typeof r[k]&&(a[k].topEdge.css({width:x,height:30,background:c[k],transform:"rotateX(90deg) translate3d(0,-15px,15px)"}),a[k].bottomEdge.css({width:x,height:30,background:c[k],transform:"rotateX(90deg) translate3d(0,-15px,"+(-g+15)+"px)"}),a[k].leftEdge.css({width:30,height:g,background:c[k],transform:"rotateY(90deg) translate3d(15px,0,-15px)"}),
a[k].rightEdge.css({width:30,height:g,background:c[k],transform:"rotateY(90deg) translate3d(15px,0,"+(x-15)+"px)"}));D.css({transformOrigin:u/2+"px "+h/2+"px 0",width:u,height:h});for(var e in a)"function"!==typeof a[e]&&(u=y[e].delay*d,l[1]<=u&&(l[0]=e,l[1]=u),a[e].part[0].ws_delay=[u,0]);a[l[0]].part[0].ws_delay[1]=1;for(e in a)"function"!==typeof a[e]&&(d=a[e],d.animate={delay:d.part[0].ws_delay[0],duration:t,begin:{left:0,top:0,width:x,height:g,scale:1,rotateX:0,rotateY:0,translate3d:[0,0,G?30:
0]},half:{left:y[e].halfLeft*x,top:y[e].halfTop*g,scale:y[e].halfScale,rotateX:y[e].rotateX/2,rotateY:y[e].rotateY/2,translate3d:[0,0,30*(G?1:.5)]},end:{left:0,top:0,scale:1,rotateX:y[e].rotateX,rotateY:y[e].rotateY,translate3d:[0,0,30]}},d.front.find("img").css(n),d.back.css("backfaceVisibility","hidden").find("img").css(n),d.part.css({width:d.animate.begin.width,height:d.animate.begin.height,left:d.animate.begin.left,top:d.animate.begin.top}));m(a,q)}var n=jQuery,K=n(this),v=b.cols||4,z=b.rows||
3,t=b.perspective||2E3,H=f.find(".ws_list"),r=[],F={},D=n("<div>").addClass("ws_effect ws_brick").appendTo(f),A=b.support.transform&&b.support.transition&&b.support.perspective,G=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),O=/Firefox/.test(navigator.userAgent),y=[{zIndex:0,rotateX:360,rotateZ:-360,rotateY:180,halfScale:.5,halfLeft:.7,halfTop:.7,delay:.36},{zIndex:1,rotateX:-360,rotateZ:360,rotateY:180,halfScale:.5,halfLeft:.2,halfTop:.4,delay:.81},{zIndex:1,rotateX:360,
rotateZ:-360,rotateY:-180,halfScale:.5,halfLeft:-.2,halfTop:.4,delay:.45},{zIndex:0,rotateX:-360,rotateZ:360,rotateY:-180,halfScale:.5,halfLeft:-.7,halfTop:.7,delay:.63},{zIndex:1,rotateX:-360,rotateZ:360,rotateY:-180,halfScale:.5,halfLeft:.7,halfTop:0,delay:.54},{zIndex:2,rotateX:360,rotateZ:-360,rotateY:180,halfScale:.5,halfLeft:.2,halfTop:0,delay:.38},{zIndex:2,rotateX:360,rotateZ:-360,rotateY:-180,halfScale:.5,halfLeft:-.2,halfTop:0,delay:0},{zIndex:1,rotateX:-360,rotateZ:360,rotateY:180,halfScale:.5,
halfLeft:-.7,halfTop:0,delay:.72},{zIndex:0,rotateX:-360,rotateZ:360,rotateY:180,halfScale:.5,halfLeft:.7,halfTop:-.7,delay:1},{zIndex:1,rotateX:-360,rotateZ:360,rotateY:-180,halfScale:.5,halfLeft:.2,halfTop:-.4,delay:.7},{zIndex:1,rotateX:360,rotateZ:-360,rotateY:180,halfScale:.5,halfLeft:-.2,halfTop:-.4,delay:.57},{zIndex:0,rotateX:360,rotateZ:-360,rotateY:-180,halfScale:.5,halfLeft:-.7,halfTop:-.7,delay:.9}];D.css({position:"absolute",top:0,left:0,width:f.width(),height:f.height(),transform:"translate3d(0,0,0)",
transformOrigin:b.width/2+"px "+b.height/2+"px 0",perspective:t}).hide();for(t=0;t<v*z;t++){var B=t%v,I=Math.floor(t/v),L=n("<div>").css({position:"absolute",left:100*B/v+"%",top:100*I/z+"%",outline:"1px solid transparent",transformStyle:G||O?"flat":"preserve-3d",zIndex:y[t].zIndex,overflow:A?"visible":"hidden"}).appendTo(D),C=n("<div>").css({transform:"scale(1) rotateX(0) rotateY(0) translate3d(0,0,0)",outline:"1px solid transparent",transformStyle:"preserve-3d"}).appendTo(L),M=n("<div>").addClass("ws_front_image").appendTo(C),
N=A?n("<div>").addClass("ws_back_image").appendTo(C):0;M.css({position:"absolute",width:"100%",height:"100%",overflow:"hidden",backfaceVisibility:"hidden",transform:"translate3d(0,0,0)"}).append(n("<img>").css({left:100*-B+"%",top:100*-I+"%",position:"absolute",outline:"1px solid transparent"}));A&&N.css({position:"absolute",width:"100%",height:"100%",overflow:"hidden",backfaceVisibility:"hidden",transform:"rotateY(180deg) translate3d(0,0,30px)"}).append(n("<img>").css({left:100*-B+"%",top:100*-I+
"%",position:"absolute",outline:"1px solid transparent"}));B={position:"absolute",outline:"1px solid transparent"};r[t]={part:C,front:M,back:N,wrapper:L,leftEdge:A?n("<div>").addClass("ws_left_edge").css(B).appendTo(C):0,rightEdge:A?n("<div>").addClass("ws_right_edge").css(B).appendTo(C):0,topEdge:A?n("<div>").addClass("ws_top_edge").css(B).appendTo(C):0,bottomEdge:A?n("<div>").addClass("ws_bottom_edge").css(B).appendTo(C):0}}var E;this.go=function(p,m){if(E)return m;D.show();var t=n(a.get(m)),t=
{width:t.width(),height:t.height(),marginTop:parseFloat(t.css("marginTop")),marginLeft:parseFloat(t.css("marginLeft"))};if(A){r[0].front.find("img").on("load",function(){H.hide()});for(var w in r)"function"!==typeof r[w]&&(r[w].front.find("img").attr("src",a.get(m).src),r[w].back.find("img").attr("src",a.get(p).src));F[m]||(F[m]=q(m));E=new c(r,m,t,function(){H.show();K.trigger("effectEnd");D.hide();for(var a in r)"function"!==typeof r[a]&&r[a].part.css({transition:"",transform:"rotateX(0) rotateY(0) translate3d(0,0,0)"});
E=0})}else{E=!0;var u=f.width(),h=f.height(),x=u/v,g=h/z;D.css({width:u,height:h});var d=0;for(w in r){u=w%v;h=Math.floor(w/v);r[w].front.find("img").attr("src",a.get(p).src).css(t);var u=b.duration*(1-Math.abs((5-u*h)/(2*z*v))),h=0<3*Math.random()+-1?1:-1,y=0<3*Math.random()+-1?1:-1;r[w].wrapper.css({width:x,height:g});r[w].part.css({position:"absolute",top:h*g,left:y*x,opacity:0,width:x,height:g}).animate({top:0,left:0,opacity:1},u,function(){d++;d==z*v&&(H.stop(1,1),E=!1,K.trigger("effectEnd"))})}}}}
;
// ken burns 
// options.paths=[{ from:[X,Y,Ratio], to:[X,Y,Ratio] },...] - transition description
// 					from - begin state, to - end state
// 					X,Y = 0..1 - relative position, 
//					Ratio>1 - degree of stretching, 
function ws_kenburns(d,t,z){function u(b){return h[b?Math.floor(Math.random()*(m?h.length:Math.min(5,h.length))):0]}function v(){g=f('<div style="width:100%;height:100%"></div>').css({"z-index":8,position:"absolute",left:0,top:0}).appendTo(A)}function w(b,c,d){var a={width:100*b[2]+"%"};a[c?"right":"left"]=-100*(b[2]-1)*(c?1-b[0]:b[0])+"%";a[d?"bottom":"top"]=-100*(b[2]-1)*(d?1-b[1]:b[1])+"%";if(!m)for(var e in a)/\%/.test(a[e])&&(a[e]=(/right|left|width/.test(e)?k:l)*parseFloat(a[e])/100+"px");return a}
function x(b,c,h){var a=f(b),a={width:a.width(),height:a.height(),marginTop:a.css("marginTop"),marginLeft:a.css("marginLeft")};m&&(r&&r.stop(1),r=y);n&&n.remove();n=g;v();h&&(g.hide(),n.stop(!0,!0));if(m){var e,p,q;q=f('<canvas width="'+k+'" height="'+l+'"/>');q.css({position:"absolute",left:0,top:0}).css(a).appendTo(g);e=q.get(0).getContext("2d");p=q.clone().appendTo(g).get(0).getContext("2d");y=wowAnimate(function(a){a=[c.from[0]*(1-a)+a*c.to[0],c.from[1]*(1-a)+a*c.to[1],c.from[2]*(1-a)+a*c.to[2]];
p.drawImage(b,-k*(a[2]-1)*a[0],-l*(a[2]-1)*a[1],k*a[2],l*a[2]);e.clearRect(0,0,k,l);a=e;e=p;p=a},0,1,d.duration+2*d.delay)}else k=a.width,l=a.height,f('<img src="'+b.src+'"/>').css({position:"absolute",left:"auto",right:"auto",top:"auto",bottom:"auto"}).appendTo(g).css(w(c.from,.5<c.from[0],.5<c.from[1])).animate(w(c.to,.5<c.from[0],.5<c.from[1]),{easing:"linear",queue:!1,duration:1.5*d.duration+d.delay});h&&g.fadeIn(d.duration)}var f=jQuery,B=f(this),m=document.createElement("canvas").getContext,
A=f("<div>").css({position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"}).addClass("ws_effect ws_kenburns").appendTo(z),h=d.paths||[{from:[0,0,1],to:[0,0,1.2]},{from:[0,0,1.2],to:[0,0,1]},{from:[1,0,1],to:[1,0,1.2]},{from:[0,1,1.2],to:[0,1,1]},{from:[1,1,1],to:[1,1,1.2]},{from:[.5,1,1],to:[.5,1,1.3]},{from:[1,.5,1.2],to:[1,.5,1]},{from:[1,.5,1],to:[1,.5,1.2]},{from:[0,.5,1.2],to:[0,.5,1]},{from:[1,.5,1.2],to:[1,.5,1]},{from:[.5,.5,1],to:[.5,.5,1.2]},{from:[.5,.5,1.3],to:[.5,
.5,1]},{from:[.5,1,1],to:[.5,0,1.15]}],k=d.width,l=d.height,y,r,g,n;v();1==d.effect.length&&f(function(){t.each(function(b){f(this).css({visibility:"hidden"});b==d.startSlide&&x(this,u(b),0)})});this.go=function(b,c){setTimeout(function(){B.trigger("effectEnd")},d.duration);x(t.get(b),u(b),1)}};
